apiVersion: v1
kind: ConfigMap
metadata:
  name: workspaceconfiguration-api-config
  namespace: default
  labels:
    app: workspaceconfiguration-api
data:
  appsettings.json: |
    {
        "BaseAddress": "http://workspaceconfiguration-api-clusterip-srv:8080",
        "ConnectionString" :"Data Source=/app/storage/workspaceconfigurations.db",
        "MqttConfig": {
            "HostName": "mosquitto-clusterip-srv",
            "Password": "mcce22-smart-office",
            "Port": 1883,
            "UserName": "iot"
        },
        "Serilog": {
            "MinimumLevel": {
                "Default": "Debug",
                "Override": {
                    "Microsoft": "Debug",
                    "System": "Debug"
                }
            },
            "WriteTo": [
                {
                    "Args": {
                        "OutputTemplate": "{Timestamp:yyyy-MM-dd HH:mm:ss} [{Level:u3}] {Message:lj}{NewLine}{Exception}"
                    },
                    "Name": "Console"
                }
            ]
        }
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: workspaceconfiguration-api-depl
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: workspaceconfiguration-api
  template:
    metadata:
      labels:
        app: workspaceconfiguration-api
    spec:
      containers:
        - name: workspaceconfiguration-api
          image: domih/mcce-smart-office-workspaceconfiguration-api:latest
          resources:
            requests:
              memory: "256Mi"
              cpu: "250m"
            limits:
              memory: "512Mi"
              cpu: "1000m"
          volumeMounts:
            - name: workspaceconfiguration-api-config
              mountPath: /app/appsettings.json
              subPath: appsettings.json
      volumes:
        - name: workspaceconfiguration-api-config
          configMap:
            name: workspaceconfiguration-api-config
---
apiVersion: v1
kind: Service
metadata:
  name: workspaceconfiguration-api-clusterip-srv
  namespace: default
spec:
  type: ClusterIP
  selector:
    app: workspaceconfiguration-api
  ports:
    - name: workspaceconfiguration-api
      protocol: TCP
      port: 80
      targetPort: 8080
